import{r,j as e,$ as Oe,c as Ue,R as De}from"./vendor-react-Dh9xy-2U.js";import{e as Fe}from"./vendor-Ydzh2Zwd.js";import{d as Ke}from"./vendor-atproto-C7zu0mmT.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const f of h.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&a(f)}).observe(document,{childList:!0,subtree:!0});function o(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function a(i){if(i.ep)return;i.ep=!0;const h=o(i);fetch(i.href,h)}})();const re=300;function We(l){const o=String(l||"").replace(/\r\n/g,`
`).split(`
`),a=[];let i=[];for(const h of o)h.trim()==="---"?(a.push(i.join(`
`)),i=[]):i.push(h);return a.push(i.join(`
`)),a}function Ge(l){const s=l.replace(/\s+/g," "),o=/[^.!?]+[.!?]*(?:\s+|$)/g,a=[];let i;for(;(i=o.exec(s))!==null;)a.push(i[0]);return a.length?a:[s]}function qe(l,s){if(!l)return[""];const o=[];let a=0;for(;a<l.length;)o.push(l.slice(a,a+s)),a+=s;return o}function Je(l,{appendNumbering:s=!0,limit:o=re}={}){const a=We(l),h=Math.max(20,o-(s?8:0)),f=[];a.forEach(z=>{const L=z.replace(/\s+$/u,"");if(!L){f.push("");return}if(L.length<=h){f.push(L);return}const E=Ge(L);let j="";E.forEach(c=>{const m=j?j+c:c;if(m.trim().length<=h)j=m;else{j.trim()&&f.push(j.trim());let b=c.trim();if(b.length>h){const k=qe(b,h);f.push(...k.slice(0,-1).map(P=>P.trim())),b=k[k.length-1]}j=b}}),j.trim()&&f.push(j.trim())});const B=f.length;return f.map((z,L)=>{if(!s)return z;const E=`

${L+1}/${B}`;return`${z}${E}`})}function Ze({open:l,onClose:s,onPick:o,browserKey:a,maxBytes:i=8*1024*1024}){const h=(a??void 0)||"",[f,B]=r.useState(""),[z,L]=r.useState([]),[E,j]=r.useState(!1),[c,m]=r.useState(""),[b,k]=r.useState(null);r.useEffect(()=>{l||(B(""),L([]),j(!1),m(""),k(null)),l&&(async()=>{try{j(!0);const p=new URLSearchParams({limit:"10"});let d=!1;try{const N=`/api/tenor/featured?${p.toString()}`,T=await fetch(N);if(T.ok){const w=await T.json(),F=(Array.isArray(w==null?void 0:w.results)?w.results:[]).map(M=>{const y=M.media_formats||{},S=y.tinygif||y.nanogif||y.gif,H=y.gif||y.tinygif||y.nanogif;return{id:M.id,previewUrl:(S==null?void 0:S.url)||(H==null?void 0:H.url),variants:{gif:y.gif||null,tinygif:y.tinygif||null,nanogif:y.nanogif||null}}});L(F),k((w==null?void 0:w.next)||null),m(""),d=!0}}catch{}if(!d&&h){const T=`https://tenor.googleapis.com/v2/featured?${new URLSearchParams({key:h,client_key:"threadwriter",limit:"10",media_filter:"gif,tinygif,nanogif"}).toString()}`,w=await fetch(T);if(w.ok){const R=await w.json(),M=(Array.isArray(R==null?void 0:R.results)?R.results:[]).map(y=>{const S=y.media_formats||{},H=S.tinygif||S.nanogif||S.gif,$=S.gif||S.tinygif||S.nanogif;return{id:y.id,previewUrl:(H==null?void 0:H.url)||($==null?void 0:$.url),variants:{gif:S.gif||null,tinygif:S.tinygif||null,nanogif:S.nanogif||null}}});L(M),k((R==null?void 0:R.next)||null),m(""),d=!0}}d||m("Tenor nicht erreichbar. Backendâ€‘Proxy oder Browserâ€‘Key nÃ¶tig.")}catch{}finally{j(!1)}})()},[l]);async function P(p=!0){const d=f.trim();if(d){j(!0),m("");try{const N=new URLSearchParams({q:d,limit:"24"});!p&&b&&N.set("pos",b);let T=null,w=!1;try{const M=`/api/tenor/search?${N.toString()}`,y=await fetch(M);y.ok&&(T=await y.json(),w=!0)}catch{}if(!w&&h){const M=new URLSearchParams({q:d,key:h,client_key:"threadwriter",limit:"24",media_filter:"gif,tinygif,nanogif"});!p&&b&&M.set("pos",b);const y=`https://tenor.googleapis.com/v2/search?${M.toString()}`,S=await fetch(y);if(!S.ok)throw new Error(`HTTP ${S.status}`);T=await S.json(),w=!0}if(!w)throw new Error("Tenor nicht erreichbar (Proxy/Key)");const F=(Array.isArray(T==null?void 0:T.results)?T.results:[]).map(M=>{const y=M.media_formats||{},S=y.tinygif||y.nanogif||y.gif,H=y.gif||y.tinygif||y.nanogif;return{id:M.id,previewUrl:(S==null?void 0:S.url)||(H==null?void 0:H.url),variants:{gif:y.gif||null,tinygif:y.tinygif||null,nanogif:y.nanogif||null}}});L(M=>p?F:M.concat(F)),k((T==null?void 0:T.next)||null)}catch(N){m((N==null?void 0:N.message)||String(N))}finally{j(!1)}}}function W(p){if(p==null)return 0;if(typeof p=="number")return p;if(typeof p=="string"){const d=parseInt(p.replace(/[^0-9]/g,""),10);return Number.isFinite(d)?d:0}return 0}function C(p,d){const N=["nanogif","tinygif","gif"];for(const T of N){const w=p[T];if(!w||!w.url)continue;const R=W(w.size);if(!R||R<=d)return w}for(const T of N){const w=p[T];if(w&&w.url)return w}return null}return l?e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{width:"min(960px, 92vw)",maxHeight:"88vh",background:"#fff",borderRadius:12,boxShadow:"0 20px 40px rgba(0,0,0,.2)",display:"grid",gridTemplateRows:"auto 1fr auto"},children:[e.jsxs("div",{style:{padding:12,borderBottom:"1px solid #eee",display:"flex",gap:8},children:[e.jsx("input",{value:f,onChange:p=>B(p.target.value),onKeyDown:p=>{p.key==="Enter"&&f.trim()&&!E&&(p.preventDefault(),P(!0))},placeholder:"GIF suchen (Tenor)",style:{flex:1,padding:"8px 10px",border:"1px solid #ddd",borderRadius:8}}),e.jsx("button",{onClick:()=>P(!0),disabled:E||!f.trim(),style:{padding:"8px 12px",borderRadius:8,background:"#0a66c2",color:"#fff",border:"none"},children:"Suchen"}),e.jsx("button",{onClick:s,style:{padding:"8px 12px",borderRadius:8,background:"#eee",border:"1px solid #ddd"},children:"SchlieÃŸen"})]}),e.jsxs("div",{style:{overflow:"auto",padding:12},"aria-busy":E,children:[c?e.jsxs("p",{style:{color:"#900",fontSize:12},children:["Fehler: ",c]}):null,E?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:10},children:Array.from({length:10}).map((p,d)=>e.jsx("div",{style:{height:100,background:"#f2f2f2",border:"1px solid #eee",borderRadius:10}},d))}):z.length===0?e.jsx("p",{style:{fontSize:13,color:"#666"},children:"Suchbegriff eingeben und Suchen klicken."}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:10},children:z.map(p=>e.jsx("button",{onClick:()=>{const d=C(p.variants,i)||{};d.url&&o({id:p.id,downloadUrl:d.url,previewUrl:p.previewUrl||d.url})},style:{border:"1px solid #eee",borderRadius:10,padding:6,background:"#fff",cursor:"pointer"},children:e.jsx("img",{src:p.previewUrl,alt:"GIF",style:{width:"100%",height:100,objectFit:"cover",borderRadius:6}})},p.id))})]}),e.jsxs("div",{style:{padding:12,borderTop:"1px solid #eee",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:12,color:"#666"},children:E?"LÃ¤dtâ€¦":`${z.length} Ergebnisse${b?"â€¦":""}`}),e.jsx("button",{onClick:()=>P(!1),disabled:!b||E,style:{padding:"8px 12px",borderRadius:8,background:"#f3f4f6",border:"1px solid #e5e7eb"},children:"Mehr laden"})]})]})}):null}const Se=["ðŸ˜€","ðŸ˜","ðŸ˜‚","ðŸ¤£","ðŸ˜Š","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜‡","ðŸ¥³","ðŸ¤©","ðŸ˜Ž","ðŸ¤“","ðŸ¤”","ðŸ˜´","ðŸ¤¯","ðŸ¤—","ðŸ¤","â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ–¤","ðŸ¤","ðŸ¤Ž","ðŸ’–","ðŸ’”","ðŸ’¯","âœ¨","â­","ðŸŒŸ","âš¡","ðŸ”¥","ðŸš€","ðŸ‘","ðŸ‘Ž","ðŸ‘","ðŸ™Œ","ðŸ™","ðŸ’ª","ðŸ«¶","ðŸ¤","â˜•","ðŸ¿","ðŸ“","ðŸ“£","ðŸ§µ","ðŸ“·","ðŸŽ¯","ðŸ§ ","ðŸ› ï¸","ðŸ•’","âœ…","âŒ","âš ï¸","â—","â“","â„¹ï¸","ðŸ“Œ","ðŸ”—","ðŸ“Ž","ðŸ—“ï¸","â°","ðŸ’¡","ðŸ”’","ðŸ”“","ðŸ§¹","ðŸ§ª","ðŸ§­","ðŸ“¦"],ke={smile:["ðŸ˜€","ðŸ˜","ðŸ˜‚","ðŸ¤£","ðŸ˜Š","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜‡","ðŸ¥³","ðŸ¤©","ðŸ˜Ž","ðŸ¤“","ðŸ¤”","ðŸ˜´","ðŸ¤¯","ðŸ¤—"],love:["â¤ï¸","ðŸ’–","ðŸ’œ","ðŸ’™","ðŸ’š","ðŸ’›","ðŸ§¡","ðŸ¤","ðŸ¤Ž","ðŸ’”","ðŸ’¯"],hands:["ðŸ‘","ðŸ‘Ž","ðŸ‘","ðŸ™Œ","ðŸ™","ðŸ’ª","ðŸ«¶","ðŸ¤"],ok:["âœ…","ðŸ‘","ðŸ‘"],no:["âŒ","ðŸ‘Ž"],warn:["âš ï¸","â—"],info:["â„¹ï¸","ðŸ’¡"],star:["â­","ðŸŒŸ","âœ¨"],fire:["ðŸ”¥"],rocket:["ðŸš€"],time:["ðŸ—“ï¸","â°","ðŸ•’"],media:["ðŸ“·","ðŸ§µ","ðŸ“£","ðŸ“"]};function Ye({open:l,onClose:s,onPick:o,anchorRef:a}){const[i,h]=r.useState(""),[f,B]=r.useState(()=>{try{return JSON.parse(localStorage.getItem("tw_recent_emoji")||"[]")}catch{return[]}});r.useEffect(()=>{try{localStorage.setItem("tw_recent_emoji",JSON.stringify(f.slice(0,30)))}catch{}},[f]),r.useEffect(()=>{if(!l)return;const c=m=>{m.key==="Escape"&&(s==null||s())};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[l,s]);const z=useRef(null),[L,E]=r.useState({top:0,left:0});r.useEffect(()=>{if(!l)return;const c=()=>{try{const b=a==null?void 0:a.current;if(!b)return;const k=b.getBoundingClientRect(),P=window.innerWidth,W=window.innerHeight,C=Math.min(420,Math.floor(P*.92)),p=Math.min(560,Math.floor(W*.8));let d=k.bottom+8,N=k.left;d+p>W-8&&(d=Math.max(8,k.top-8-p)),N+C>P-8&&(N=Math.max(8,P-8-C)),E({top:d,left:N})}catch{}};c();const m=()=>c();return window.addEventListener("resize",c),window.addEventListener("scroll",m,!0),()=>{window.removeEventListener("resize",c),window.removeEventListener("scroll",m,!0)}},[l,a]),r.useEffect(()=>{if(!l)return;const c=m=>{const b=z.current,k=a==null?void 0:a.current;b&&b.contains(m.target)||k&&k.contains(m.target)||s==null||s()};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[l,s,a]),r.useMemo(()=>{const c=i.trim().toLowerCase();if(!c)return Array.from(new Set([...f||[],...Se]));const m=ke[c];if(m)return m;const b=Object.entries(ke).find(([k])=>k.includes(c));return b?b[1]:Se},[i,f]);function j(c){try{c&&B(m=>[c,...m.filter(b=>b!==c)].slice(0,30))}catch{}o==null||o(c)}return l?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,pointerEvents:"none"},children:e.jsx("div",{ref:z,className:"panel em-picker-wrap",style:{position:"fixed",top:L.top,left:L.left,width:"min(92vw, 420px)",maxHeight:"80vh",padding:8,pointerEvents:"auto"},children:e.jsx(Oe,{data:Fe,onEmojiSelect:c=>j((c==null?void 0:c.native)||(c==null?void 0:c.shortcodes)||(c==null?void 0:c.id)),locale:"de",theme:"auto",dynamicWidth:!1,navPosition:"top",previewPosition:"none",style:{width:"100%"}})})}):null}function ze({open:l,onClose:s,title:o,actions:a,children:i,contentWidth:h}){return l?e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{className:"panel",style:{width:h||"min(560px, 92vw)",maxHeight:"80vh",display:"grid",gridTemplateRows:"auto 1fr auto",padding:0},children:[e.jsxs("div",{style:{padding:10,borderBottom:"1px solid hsl(var(--border))",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{fontSize:15,fontWeight:700,margin:0},children:o}),e.jsx("button",{className:"btn btn-icon","aria-label":"SchlieÃŸen",title:"SchlieÃŸen",onClick:s,children:e.jsx("svg",{className:"icon",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{d:"M18.3 5.71 12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.3 19.71 2.89 18.3 9.18 12 2.89 5.71 4.3 4.29 10.59 10.6l6.3-6.31z"})})})]}),e.jsx("div",{style:{padding:12,overflow:"auto"},children:e.jsx("div",{className:"prose-compact",children:i})}),e.jsx("div",{style:{padding:10,borderTop:"1px solid hsl(var(--border))",display:"flex",justifyContent:"flex-end",gap:8},children:a||e.jsx("button",{className:"btn btn-primary",onClick:s,children:"OK"})})]})}):null}async function Ee(l,{targetBytes:s=900*1024,maxWidth:o=2048,maxHeight:a=2048,preferType:i="image/webp"}={}){const h=(l.type||"").toLowerCase();if(!h||h==="image/gif")return{blob:l,type:l.type||"application/octet-stream"};const f=await new Promise((C,p)=>{const d=new FileReader;d.onload=()=>C(d.result),d.onerror=p,d.readAsDataURL(l)}),B=await new Promise((C,p)=>{const d=new Image;d.onload=()=>C(d),d.onerror=p,d.src=f}),z=B.naturalWidth||B.width,L=B.naturalHeight||B.height,E=Math.min(1,o/z,a/L),j=Math.max(1,Math.round(z*E)),c=Math.max(1,Math.round(L*E)),m=document.createElement("canvas");m.width=j,m.height=c,m.getContext("2d",{alpha:!0}).drawImage(B,0,0,j,c);const k=[i,"image/jpeg","image/png"],P=[.9,.8,.7,.6,.5,.4];for(const C of k)for(const p of P){const d=await new Promise(N=>m.toBlob(N,C,p));if(d&&d.size<=s)return{blob:d,type:C}}return{blob:await new Promise(C=>m.toBlob(C,"image/jpeg",.35))||l,type:"image/jpeg"}}class Xe{constructor(s="https://bsky.social"){this.agent=new Ke.BskyAgent({service:s}),this.session=null}async login(s,o){if(!s||!o)throw new Error("Identifier und Appâ€‘Passwort erforderlich.");return this.session=await this.agent.login({identifier:s,password:o}),this.session}async postThread(s){if(!Array.isArray(s)||s.length===0)throw new Error("Keine Segmente");const o=[];let a=null,i=null;for(let h=0;h<s.length;h++){const f=await this.agent.post({text:s[h],reply:a&&i?{root:a,parent:i}:void 0}),B={uri:f.uri,cid:f.cid};a||(a=B),i=B,o.push(B)}return o}}async function Ne(l,s){const o=new TextEncoder,a=await crypto.subtle.importKey("raw",o.encode(l),{name:"PBKDF2"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:15e4,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}function de(l){return Uint8Array.from(atob(l),s=>s.charCodeAt(0))}function ue(l){let s="";const o=new Uint8Array(l),a=o.byteLength;for(let i=0;i<a;i++)s+=String.fromCharCode(o[i]);return btoa(s)}async function Qe(l,s){const o=crypto.getRandomValues(new Uint8Array(12)),a=crypto.getRandomValues(new Uint8Array(16)),i=await Ne(s,a),h=new TextEncoder,f=await crypto.subtle.encrypt({name:"AES-GCM",iv:o},i,h.encode(l));return JSON.stringify({v:1,iv:ue(o),salt:ue(a),ct:ue(f)})}async function et(l,s){const{iv:o,salt:a,ct:i}=JSON.parse(l||"{}");if(!o||!a||!i)throw new Error("Invalid payload");const h=await Ne(s,de(a)),f=await crypto.subtle.decrypt({name:"AES-GCM",iv:de(o)},h,de(i));return new TextDecoder().decode(f)}function tt(){const[l,s]=r.useState(()=>{try{return localStorage.getItem("tw_identifier")??""}catch{return""}}),[o,a]=r.useState(()=>{try{return localStorage.getItem("tw_password")??""}catch{return""}}),[i,h]=r.useState(()=>{try{return localStorage.getItem("tw_remember")==="1"}catch{return!1}}),[f,B]=r.useState(""),[z,L]=r.useState(()=>{try{return localStorage.getItem("tw_tenor_key")||""}catch{return""}}),[E,j]=r.useState(""),c=r.useRef(null),[m,b]=r.useState(!1),k=r.useRef(null),[P,W]=r.useState(!0),[C,p]=r.useState(!1),[d,N]=r.useState("write"),[T,w]=r.useState(!1),[R,F]=r.useState(!1),[M,y]=r.useState(()=>{try{return localStorage.getItem("tw_theme")||"light"}catch{return"light"}}),[S,H]=r.useState(()=>{try{return localStorage.getItem("tw_use_emoji_mart")==="1"}catch{return!1}}),[$,G]=r.useState([]),[he,ie]=r.useState(""),[V,Y]=r.useState({}),[Ie,pe]=r.useState(null),ae=r.useRef(null),[ee,Me]=r.useState(()=>{try{return localStorage.getItem("tw_server_url")||"https://bsky.social"}catch{return"https://bsky.social"}}),X=4,le=8*1024*1024,fe=Number(900*1024),ge=Math.max(.5,Math.min(1,.97)),me=["image/jpeg","image/png","image/webp","image/gif"],[Te,te]=r.useState(!1),[Ae,ye]=r.useState(null),xe=r.useRef(null),[be,Le]=r.useState(66),oe=r.useRef(!1),[ce,we]=r.useState(!1),_=r.useMemo(()=>Je(E,{appendNumbering:P,limit:re}),[E,P]),Be=r.useMemo(()=>_.map(n=>n.length),[_]),ve=r.useMemo(()=>_.map(n=>n.length>re),[_]),Ce=r.useMemo(()=>_.map((n,t)=>n.trim().length>0||Array.isArray(V[t])&&V[t].length>0),[_,V]),_e=l&&o&&_.length>0&&ve.every(n=>!n)&&Ce.every(Boolean);r.useEffect(()=>{try{localStorage.setItem("tw_remember",i?"1":"0"),i&&f&&l&&o?(async()=>{const t=await Qe(JSON.stringify({identifier:l,password:o}),f);localStorage.setItem("tw_cred_v2",t)})():i||localStorage.removeItem("tw_cred_v2")}catch{}},[l,o,i,f]),r.useEffect(()=>{(async()=>{try{if(!f)return;const n=localStorage.getItem("tw_cred_v2");if(!n)return;const t=await et(n,f),u=JSON.parse(t);u!=null&&u.identifier&&s(u.identifier),u!=null&&u.password&&a(u.password)}catch{}})()},[f]),r.useEffect(()=>{try{localStorage.setItem("tw_tenor_key",z||"")}catch{}},[z]),r.useEffect(()=>{try{localStorage.setItem("tw_server_url",ee||"")}catch{}},[ee]),r.useEffect(()=>{try{localStorage.setItem("tw_use_emoji_mart",S?"1":"0")}catch{}},[S]),r.useEffect(()=>{let n=!1;const t=new AbortController,u=setTimeout(()=>t.abort(),2500);return(async()=>{try{const g=await fetch("/api/tenor/featured?limit=1",{signal:t.signal});n||we(g.ok)}catch{n||we(!1)}finally{clearTimeout(u)}})(),()=>{n=!0,clearTimeout(u),t.abort()}},[]),r.useEffect(()=>{const n=document.documentElement;n.classList.remove("dark"),n.removeAttribute("data-theme"),M==="dark"?n.classList.add("dark"):M==="midnight"&&n.setAttribute("data-theme","midnight");try{localStorage.setItem("tw_theme",M)}catch{}},[M]);function Pe(){y(n=>n==="light"?"dark":n==="dark"?"midnight":"light")}function Re(n){try{const t=c.current;if(!t){j(A=>`${A}${n}`);return}const u=t.selectionStart??E.length,g=t.selectionEnd??u,v=E.slice(0,u),x=E.slice(g),I=`${v}${n}${x}`;j(I),requestAnimationFrame(()=>{try{t.focus();const A=u+String(n).length;t.setSelectionRange(A,A)}catch{}})}catch{j(t=>`${t}${n}`)}}async function He(){var n;ie(""),G(_.map(()=>({state:"pending"}))),p(!0);try{const t=new Xe((ee||"").trim()||"https://bsky.social");await t.login(l.trim(),o.trim());let u=null,g=null;for(let v=0;v<_.length;v++){G(x=>x.map((I,A)=>A===v?{state:"posting"}:I));try{let x;const I=Array.isArray(V[v])?V[v]:[];if(I.length>0){const K=[];for(let D=0;D<I.length;D++){const ne=I[D];G(J=>J.map((Z,$e)=>$e===v?{state:"posting",info:`Medien hochladen ${D+1}/${I.length}`}:Z));const Q=ne.file,je=(Q.type||"").toLowerCase()==="image/gif";let se=Q,q=Q.type||"image/jpeg";if(!je)try{const J=await Ee(Q,{targetBytes:Math.floor(fe*ge),maxWidth:2048,maxHeight:2048,preferType:"image/webp"});se=J.blob,q=J.type||q}catch{}let U;try{U=await t.agent.uploadBlob(se,{encoding:q})}catch(J){if(je)throw J;try{const Z=await Ee(Q,{targetBytes:Math.floor(Math.max(fe*.8*ge,409600)),maxWidth:1920,maxHeight:1920,preferType:"image/webp"});se=Z.blob,q=Z.type||q,U=await t.agent.uploadBlob(se,{encoding:q})}catch(Z){throw Z}}const Ve=((n=U==null?void 0:U.data)==null?void 0:n.blob)||(U==null?void 0:U.blob)||(U==null?void 0:U.data);K.push({blob:Ve,alt:ne.alt||""})}x={$type:"app.bsky.embed.images",images:K.map(D=>({image:D.blob,alt:D.alt||""}))}}const A=await t.agent.post({text:_[v],reply:u&&g?{root:u,parent:g}:void 0,embed:x}),O={uri:A.uri,cid:A.cid};u||(u=O),g=O,G(K=>K.map((D,ne)=>ne===v?{state:"ok",uri:O.uri}:D))}catch(x){throw G(I=>I.map((A,O)=>O===v?{state:"error",message:(x==null?void 0:x.message)||String(x)}:A)),x}}j(""),G([]),Y({})}catch(t){ie((t==null?void 0:t.message)||String(t))}finally{p(!1)}}return e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:24},children:[e.jsx("section",{className:"panel",style:{padding:16,marginBottom:12},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"eyebrow",children:"THREADWRITER"}),e.jsx("h1",{className:"title-main",style:{margin:0},children:"Thread schreiben"})]}),e.jsx("button",{className:"btn btn-icon",onClick:Pe,title:"Theme umschalten","aria-label":"Theme umschalten",children:M==="light"?e.jsx("svg",{className:"icon",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{d:"M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.79 1.8-1.79zM1 13h3v-2H1v2zm10 10h2v-3h-2v3zM4.84 19.36l1.79 1.8 1.8-1.8-1.8-1.79-1.79 1.79zM20 11V9h-3v2h3zm-7-7h-2v3h2V4zm3.24.84l1.8-1.79 1.79 1.79-1.79 1.79-1.8-1.79zM12 6a6 6 0 100 12 6 6 0 000-12z"})}):M==="dark"?e.jsx("svg",{className:"icon",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{d:"M20 15.31A8 8 0 1111.69 4 6 6 0 0020 15.31z"})}):e.jsx("svg",{className:"icon",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{d:"M12 2l2.39 4.85L20 8l-4 3.9L17 18l-5-2.6L7 18l1-6.1L4 8l5.61-1.15L12 2z"})})})]})}),e.jsxs("div",{className:"tabs",children:[e.jsx("button",{className:`tab ${d==="write"?"tab-active":""}`,onClick:()=>N("write"),children:"Schreiben"}),e.jsx("button",{className:`tab ${d==="settings"?"tab-active":""}`,onClick:()=>N("settings"),children:"Einstellungen"})]}),d==="settings"?e.jsxs("section",{className:"panel",style:{display:"grid",gap:12,marginBottom:16,padding:16},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{style:{fontSize:12,fontWeight:600},children:"Bluesky Identifier"}),e.jsx("input",{className:"input",value:l,onChange:n=>s(n.target.value),placeholder:"handle.xyz oder DID"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{style:{fontSize:12,fontWeight:600},children:"App Password"}),e.jsx("input",{className:"input",type:"password",value:o,onChange:n=>a(n.target.value),placeholder:"xxxx-xxxx-xxxx-xxxx"})]})]}),e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{style:{fontSize:12,fontWeight:600},children:"Schutzâ€‘Passwort (lokale VerschlÃ¼sselung)"}),e.jsx("input",{className:"input",type:"password",value:f,onChange:n=>B(n.target.value),placeholder:"Passwort zum Sichern/Entsperren"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{style:{fontSize:12,fontWeight:600},children:"Server URL"}),e.jsx("input",{className:"input",value:ee,onChange:n=>Me(n.target.value),placeholder:"https://bsky.social"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{style:{fontSize:12,fontWeight:600},children:"Tenor APIâ€‘Key (optional)"}),e.jsx("input",{className:"input",type:"password",value:z,onChange:n=>L(n.target.value),placeholder:"nur fÃ¼r Standaloneâ€‘Nutzung"})]}),e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:8,fontSize:12},children:[e.jsx("input",{type:"checkbox",checked:S,onChange:n=>H(n.target.checked)})," Erweiterter Emojiâ€‘Picker (emojiâ€‘mart)"]})]})]}),e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:8,fontSize:12},children:[e.jsx("input",{type:"checkbox",checked:i,onChange:n=>h(n.target.checked)})," Zugangsdaten merken (verschlÃ¼sselt lokal gespeichert)"]})]}):null,d==="write"?e.jsxs("div",{ref:xe,className:"split-grid",style:{gridTemplateColumns:`${be}fr 10px ${Math.max(10,100-be)}fr`},children:[e.jsx("div",{className:"tall-card",children:e.jsxs("section",{className:"panel h-full",style:{padding:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:18,fontWeight:600,margin:0},children:"Threadâ€‘Inhalt"}),e.jsxs("button",{type:"button",className:"chip chip-muted",onClick:()=>F(!0),title:"Hinweis anzeigen","aria-label":"Hinweis zu Threadâ€‘Inhalt anzeigen",children:[e.jsxs("svg",{className:"icon-inline",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"none",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 8.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm-1 2.5h2v6h-2z",fill:"currentColor"})]}),"Info"]})]}),e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:8,fontSize:14},children:[e.jsx("input",{type:"checkbox",checked:P,onChange:n=>W(n.target.checked)})," Nummerierung `1/x` anhÃ¤ngen"]})]}),e.jsxs("div",{className:"card-content",children:[e.jsx("textarea",{ref:c,className:"textarea mono",value:E,onChange:n=>j(n.target.value),placeholder:`Beispiel:
Intro...
---
Weiterer Skeet...`,style:{height:300,marginTop:12}}),he?e.jsxs("p",{style:{color:"hsl(var(--destructive))",marginTop:10,fontSize:13},children:["Fehler: ",he]}):null,e.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx("button",{ref:k,onClick:()=>b(!0),className:"btn btn-secondary btn-icon",title:"Emoji einfÃ¼gen","aria-label":"Emoji einfÃ¼gen",children:e.jsx("svg",{className:"icon",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{d:"M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm-3.5 7a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm7 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zM12 18c-2.3 0-4.3-1.3-5.3-3.2-.2-.4.1-.8.6-.8h9.4c.5 0 .8.4.6.8C16.3 16.7 14.3 18 12 18z"})})})}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{onClick:He,disabled:!_e||C,className:"btn btn-primary",style:{opacity:C?.7:1},children:[e.jsx("svg",{className:"icon icon-left",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{d:"M2 21l20-9L2 3v7l14 2-14 2v7z"})}),C?"Sendenâ€¦":"Posten"]}),e.jsxs("button",{onClick:()=>{j(""),G([]),ie("")},disabled:C,className:"btn",children:[e.jsx("svg",{className:"icon icon-left",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{d:"M18.3 5.71 12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.3 19.71 2.89 18.3 9.18 12 2.89 5.71 4.3 4.29 10.59 10.6l6.3-6.31z"})}),"Abbrechen"]})]})]})]})]})}),e.jsx("div",{className:"splitter",onMouseDown:n=>{n.preventDefault(),oe.current=!0;const t=g=>{if(!oe.current)return;const v=xe.current;if(!v)return;const x=v.getBoundingClientRect(),A=(g.clientX-x.left)/x.width,O=Math.max(40,Math.min(80,Math.round(A*100)));Le(O)},u=()=>{oe.current=!1,window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",u)};window.addEventListener("mousemove",t),window.addEventListener("mouseup",u)},title:"Breite anpassen","aria-label":"Breite anpassen"}),e.jsx("aside",{children:e.jsxs("section",{className:"panel sticky-top",style:{marginTop:0,padding:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("h3",{style:{fontSize:16,fontWeight:700,margin:0},children:"Vorschau"}),e.jsxs("button",{type:"button",className:"chip chip-muted",onClick:()=>w(!0),title:"Hinweis zur Vorschau anzeigen","aria-label":"Hinweis zur Vorschau anzeigen",children:[e.jsxs("svg",{className:"icon-inline",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"none",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 8.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm-1 2.5h2v6h-2z",fill:"currentColor"})]}),"Info"]})]}),e.jsxs("div",{className:"kpi",children:[_.length," ",_.length===1?"SKEET":"SKEETS"]})]}),_.length===0||_.length===1&&_[0].trim().length===0?e.jsx("p",{style:{fontSize:13,color:"#666"},children:"(keine Segmente)"}):e.jsx("div",{className:"scrollbox scrollbar-preview",children:e.jsx("ol",{style:{display:"grid",gap:12,listStyle:"none",padding:0,margin:0},children:_.map((n,t)=>e.jsxs("li",{className:"panel preview-card",children:[e.jsxs("div",{className:"preview-header",children:[e.jsxs("span",{className:"preview-title",children:["Skeet ",t+1]}),e.jsxs("div",{className:"preview-actions",children:[(()=>{const u=Be[t]||0,g=re,v=u>g*.9,I=ve[t]?"badge badge-danger":v?"badge badge-warn":"badge badge-muted";return e.jsxs("span",{className:I,children:[u,` / ${g}`]})})(),e.jsx("button",{type:"button",className:"btn btn-icon",title:"Bild hinzufÃ¼gen","aria-label":"Bild hinzufÃ¼gen",onClick:()=>{var u;pe(t),(u=ae.current)==null||u.click()},children:e.jsx("svg",{className:"icon",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{d:"M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm0 2v14h14V5H5zm3 3a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm11 9l-5-6-4 5-2-3-4 4v2h15v-2z"})})}),ce||z?e.jsx("button",{type:"button",className:"btn btn-icon",title:"GIF hinzufÃ¼gen","aria-label":"GIF hinzufÃ¼gen",onClick:()=>{ye(t),te(!0)},children:e.jsx("svg",{className:"icon",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{d:"M4 4h16a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-6l-4 4v-4H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm3.5 5H6v6h1.5V9zm6.5 0h-5v6h1.5v-2H13v-1.5h-3.5V10H14V9zm1.5 0v6H17V13h2v-1.5h-2V10h2V9h-3z"})})}):null]})]}),e.jsx("div",{className:"preview-pre mono",children:n||"(leer)"}),e.jsxs("div",{style:{marginTop:8,display:"grid",gap:8},children:[e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:(Array.isArray(V[t])?V[t]:[]).map((u,g)=>e.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:6,width:160},children:[e.jsx("div",{style:{position:"relative",height:90,background:"#fafafa",borderRadius:6,overflow:"hidden",border:"1px solid #eee"},children:e.jsx("img",{src:u.url,alt:u.alt||`Bild ${g+1}`,style:{width:"100%",height:"100%",objectFit:"contain"}})}),e.jsx("input",{type:"text",value:u.alt,onChange:v=>{const x=v.target.value;Y(I=>{const A=Array.isArray(I[t])?I[t].slice():[];return A[g]&&(A[g]={...A[g],alt:x}),{...I,[t]:A}})},placeholder:"Altâ€‘Text",style:{marginTop:6,width:"100%",padding:"6px 8px",borderRadius:6,border:"1px solid #ddd",fontSize:12}}),e.jsx("button",{onClick:()=>{Y(v=>{const x=Array.isArray(v[t])?v[t].slice():[];return x.splice(g,1),{...v,[t]:x}})},className:"btn",style:{marginTop:6},title:"Entfernen","aria-label":"Entfernen",children:e.jsx("svg",{className:"icon",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{d:"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})})})]},g))}),e.jsxs("div",{className:"only-desktop",children:[e.jsx("button",{onClick:()=>{var u;pe(t),(u=ae.current)==null||u.click()},disabled:(Array.isArray(V[t])?V[t].length:0)>=X,className:"btn btn-icon",title:"Bild hinzufÃ¼gen","aria-label":"Bild hinzufÃ¼gen",children:e.jsx("svg",{className:"icon",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{d:"M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm0 2v14h14V5H5zm3 3a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm11 9l-5-6-4 5-2-3-4 4v2h15v-2z"})})}),ce||z?e.jsx("button",{onClick:()=>{ye(t),te(!0)},disabled:(Array.isArray(V[t])?V[t].length:0)>=X,title:"GIF aus Tenor suchen",className:"btn btn-icon","aria-label":"GIF hinzufÃ¼gen",style:{marginLeft:8},children:e.jsx("svg",{className:"icon",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{d:"M4 4h16a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-6l-4 4v-4H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm3.5 5H6v6h1.5V9zm6.5 0h-5v6h1.5v-2H13v-1.5h-3.5V10H14V9zm1.5 0v6H17V13h2v-1.5h-2V10h2V9h-3z"})})}):null,e.jsxs("span",{style:{marginLeft:8,fontSize:12,color:"#666"},children:[Array.isArray(V[t])?V[t].length:0,"/",X]})]})]}),$[t]?e.jsxs("div",{style:{marginTop:6,fontSize:12},children:[$[t].state==="pending"&&e.jsx("span",{style:{color:"#777"},children:"wartetâ€¦"}),$[t].state==="posting"&&e.jsx("span",{style:{color:"#005"},children:$[t].info||"sendetâ€¦"}),$[t].state==="ok"&&e.jsxs("span",{style:{color:"#060"},children:["ok Â· ",$[t].uri]}),$[t].state==="error"&&e.jsxs("span",{style:{color:"#900"},children:["Fehler: ",$[t].message]})]}):null]},t))})})]})})]}):null,e.jsxs(ze,{open:T,onClose:()=>w(!1),title:"Hinweis: Vorschau",children:[e.jsx("p",{children:"Jeder Abschnitt bildet einen Skeet. Ãœber die Buttons in der Vorschau kannst du pro Skeet Bilder oder GIFs hinzufÃ¼gen."}),e.jsx("p",{children:"Bilder werden beim Speichern hochgeladen (max. 4 je Skeet)."}),e.jsx("p",{children:"Der ZÃ¤hler zeigt die aktuelle Zeichenanzahl je Skeet im VerhÃ¤ltnis zum Limit der ausgewÃ¤hlten Plattformen."}),e.jsx("p",{children:"Die automatische Nummerierung (1/x) kann im Formular ein- oder ausgeschaltet werden."})]}),e.jsxs(ze,{open:R,onClose:()=>F(!1),title:"Hinweis: Threadâ€‘Inhalt",children:[e.jsxs("p",{children:["Schreibe den gesamten Thread in ein Feld. Du kannst ",e.jsx("code",{className:"panel-inset",style:{padding:"2px 4px"},children:"---"})," als Trenner nutzen oder mit STRG+Enter einen Trenner einfÃ¼gen."]}),e.jsx("p",{children:"Emojis fÃ¼gst du direkt im Text ein. Medien kannst du pro Skeet in der Vorschau hinzufÃ¼gen. Maximal 4 Bilder pro Skeet."}),e.jsx("p",{children:"Der ZÃ¤hler in der Vorschau zeigt die aktuelle Zeichenanzahl je Skeet im VerhÃ¤ltnis zum Limit der gewÃ¤hlten Plattformen."}),e.jsx("p",{children:"Die automatische Nummerierung (1/x) kann Ã¼ber die Option am Editor einâ€‘ oder ausgeschaltet werden."})]}),e.jsx("input",{ref:ae,type:"file",accept:me.join(","),multiple:!0,style:{display:"none"},onChange:n=>{const t=Array.from(n.target.files||[]),u=Ie;if(typeof u=="number"&&t.length){Y(g=>{const v=Array.isArray(g[u])?g[u].slice():[];for(const x of t){if(!me.includes(x.type)||x.size>le)continue;if(v.length>=X)break;const I=URL.createObjectURL(x);v.push({file:x,url:I,alt:""})}return{...g,[u]:v}});try{n.target.value=""}catch{}}}}),e.jsx(Ze,{open:(ce||!!z)&&Te,maxBytes:le,browserKey:z,onClose:()=>te(!1),onPick:async({id:n,downloadUrl:t,previewUrl:u})=>{try{te(!1);const g=Ae;if(typeof g!="number")return;const x=await(await fetch(t)).blob();if(x.size>le){alert("GIF ist zu groÃŸ (max. ~8 MB). Bitte kleineres wÃ¤hlen.");return}const I=new File([x],`tenor-${n||"gif"}.gif`,{type:"image/gif"}),A=URL.createObjectURL(I);Y(O=>{const K=Array.isArray(O[g])?O[g].slice():[];return K.length>=X?O:(K.push({file:I,url:A,alt:""}),{...O,[g]:K})})}catch(g){alert(`GIF konnte nicht geladen werden: ${(g==null?void 0:g.message)||g}`)}}}),e.jsx(Ye,{open:m,onClose:()=>b(!1),anchorRef:k,onPick:n=>{n&&(Re(n),b(!1))}})]})}const nt=document.getElementById("root");Ue(nt).render(e.jsx(De.StrictMode,{children:e.jsx(tt,{})}));
